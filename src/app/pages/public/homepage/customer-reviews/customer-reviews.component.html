<section class="w-11/12 md:w-4/6 mx-auto my-20 dark:text-gray-200">

    <h2 class="text-xl md:text-2xl font-semibold text-center mb-10 dark:text-white">
        Ce que nos clients disent
    </h2>

    <div class="w-5/6 md:w-5/6 flex justify-center lg:justify-between items-center flex-wrap gap-8 mx-auto my-10">

        @if(topReviews.isLoading()) {
            @for(i of [1, 2, 3]; track i) {
                <article class="w-52 h-56 border border-noir rounded-lg flex flex-col justify-center items-center gap-2 py-8 px-6 dark:border-gray-600 dark:bg-gray-800 animate-pulse">
                    <div class="bg-gray-200 dark:bg-gray-700 rounded-full size-14"></div>
                    <div class="flex gap-1">
                        @for(star of [1, 2, 3, 4, 5]; track star) {
                            <div class="bg-gray-200 dark:bg-gray-700 size-4 rounded"></div>
                        }
                    </div>
                    <div class="bg-gray-200 dark:bg-gray-700 h-12 w-4/6 rounded"></div>
                </article>
            }
        } @else if(topReviews.hasValue() && reviews().length > 0) {
            @for(review of reviews(); track review.id) {
                <article class="w-52 h-56 border border-noir rounded-lg flex flex-col justify-center items-center gap-2 py-8 px-6 dark:border-gray-600 dark:bg-gray-800">
                    <!-- Avatar avec initiales -->
                    <div class="bg-vert text-white size-10 md:size-14 rounded-full flex items-center justify-center font-semibold text-lg">
                        {{getInitials(review.user.firstname, review.user.lastname)}}
                    </div>

                    <!-- Etoiles -->
                    <div class="flex justify-between items-center">
                        @for(star of getStarsArray(review.rate); track $index) {
                            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path class="fill-yellow-300" fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2L9.19 8.63L2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                        }
                        @for(star of getEmptyStarsArray(review.rate); track $index) {
                            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path class="fill-gray-300 dark:fill-gray-600" fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2L9.19 8.63L2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                        }
                    </div>

                    <!-- Commentaire -->
                    <p class="text-xs md:text-sm w-full text-center dark:text-gray-200 line-clamp-3">
                        "{{review.comment}}"
                    </p>

                    <!-- Nom -->
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        {{review.user.firstname}} {{review.user.lastname.charAt(0)}}.
                    </p>
                </article>
            }
        } @else {
            <!-- Fallback si pas de reviews ou erreur -->
            @for(review of fallbackReviews; track $index) {
                <article class="w-52 h-56 border border-noir rounded-lg flex flex-col justify-center items-center gap-2 py-8 px-6 dark:border-gray-600 dark:bg-gray-800">
                    <div class="bg-vert text-white size-10 md:size-14 rounded-full flex items-center justify-center font-semibold text-lg">
                        {{review.initials}}
                    </div>
                    <div class="flex justify-between items-center">
                        @for(star of [1, 2, 3, 4, 5]; track star) {
                            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                <path class="fill-yellow-300" fill="currentColor" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2L9.19 8.63L2 9.24l5.46 4.73L5.82 21z"/>
                            </svg>
                        }
                    </div>
                    <p class="text-xs md:text-sm w-4/6 text-center dark:text-gray-200">
                        "{{review.comment}}"
                    </p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                        {{review.name}}
                    </p>
                </article>
            }
        }

    </div>

</section>
